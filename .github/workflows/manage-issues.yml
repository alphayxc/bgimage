name: Manage Issues

on:
  issues:
    types: [opened]

permissions:
  issues: write
  contents: read

jobs:
  check-issue-creator:
    runs-on: ubuntu-latest
    steps:
      - name: Check if issue creator is authorized
        uses: actions/github-script@v7
        with:
          script: |
            // å®šä¹‰æˆæƒç”¨æˆ·åˆ—è¡¨ï¼ˆåŒ…æ‹¬ä»“åº“æ‰€æœ‰è€…ï¼‰
            const authorizedUsers = [
              context.repo.owner, // ä»“åº“æ‰€æœ‰è€…
              // åœ¨è¿™é‡Œæ·»åŠ å…¶ä»–æˆæƒç”¨æˆ·çš„ GitHub ç”¨æˆ·å
              // 'username1',
              // 'username2',
            ];

            const issueCreator = context.payload.issue.user.login;
            const isAuthorized = authorizedUsers.includes(issueCreator);

            console.log(`Issue creator: ${issueCreator}`);
            console.log(`Authorized users: ${authorizedUsers.join(', ')}`);
            console.log(`Is authorized: ${isAuthorized}`);

            if (!isAuthorized) {
              // ç«‹å³å…³é—­å¹¶é”å®š issueï¼Œé˜²æ­¢è¿›ä¸€æ­¥æ“ä½œ
              await github.rest.issues.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                state: 'closed'
              });

              // é”å®š issueï¼Œé˜²æ­¢è¯„è®º
              await github.rest.issues.lock({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                lock_reason: 'off-topic'
              });

              // æ·»åŠ è¯´æ˜è¯„è®º
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                body: `ï¿½ **æœªæˆæƒçš„ Issue åˆ›å»º**

æ­¤ä»“åº“ä»…å…è®¸ç®¡ç†å‘˜åˆ›å»ºæ–°çš„ Issuesã€‚

**å¦‚ä½•å‚ä¸ï¼š**
- ğŸ’¬ åœ¨ç°æœ‰ Issues ä¸‹è¯„è®ºè®¨è®º
- ğŸ‘ ä¸ºæ„Ÿå…´è¶£çš„å†…å®¹ç‚¹èµ
- â­ Star æœ¬ä»“åº“è·å–æ›´æ–°

---
*æ­¤ Issue å·²è¢«è‡ªåŠ¨å…³é—­å¹¶é”å®šã€‚*`
              });

              console.log('Unauthorized issue has been closed and locked.');
            } else {
              console.log('Issue creator is authorized. No action needed.');
            }
